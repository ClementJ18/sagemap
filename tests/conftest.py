"""Shared test utilities and fixtures."""

import io
from pathlib import Path
from map_parser.stream import BinaryStream
from map_parser.context import ParsingContext

assets = {248: 'WaypointsList', 247: 'CameraAnimationList', 246: 'NamedCameras', 245: 'EnvironmentData', 244: 'PostEffectsChunk', 243: 'GlobalLighting', 242: 'StandingWaveAreas', 241: 'RiverAreas', 240: 'StandingWaterAreas', 239: 'TriggerAreas', 238: 'waypointType', 237: 'objectExperienceLevel', 236: 'objectUpgradesList', 235: 'waypointPathLabel3', 234: 'waypointPathLabel2', 233: 'waypointPathLabel1', 232: 'objectName', 231: 'objectPrototypeScale', 230: 'waypointTypeOption', 229: 'waypointName', 228: 'waypointID', 227: 'objectLayer', 226: 'uniqueID', 225: 'originalOwner', 224: 'objectBasePhase', 223: 'objectBasePriority', 222: 'objectTargetable', 221: 'objectRecruitableAI', 220: 'objectPowered', 219: 'objectUnsellable', 218: 'objectIndestructible', 217: 'objectEnabled', 216: 'objectInitialHealth', 215: 'Object', 214: 'ObjectsList', 213: 'Imladris', 212: 'Dwarves', 211: 'Wild', 210: 'Angmar', 209: 'Men', 208: 'Neutral', 207: 'Civilian', 206: 'UNKNOWN', 205: 'BuildLists', 204: 'UNIT_MOVE_TOWARDS_NEAREST_OBJECT_TYPE', 203: 'PLAYER_HAS_NUMBER_UNITS_DISTANCE_FROM_OBJECT', 202: 'NAMED_USE_COMMANDBUTTON_ON_NEAREST_OBJECTTYPE', 201: 'TEAM_ALL_USE_COMMANDBUTTON_ON_NEAREST_ENEMY_BUILDING', 200: 'TYPE_SIGHTED', 199: 'TEAM_USE_COMMANDBUTTON_ABILITY_ON_NAMED', 198: 'DISTANCE_BETWEEN_TEAM', 197: 'NAMED_ATTACKED_BY_PLAYER', 196: 'TEAM_ALL_USE_COMMANDBUTTON_ON_NEAREST_ENEMY_UNIT', 195: 'NAMED_RANK_LEVEL', 194: 'PLAYER_CAN_PURCHASE_SCIENCE', 193: 'PLAYER_PURCHASE_SCIENCE', 192: 'PLAYER_KILL', 191: 'RESTART_TIMER', 190: 'STOP_TIMER', 189: 'PLAYER_HAS_NUMBER_OBJECTS_WITH_MODELCONDITION', 188: 'PLAYER_ACQUIRED_SCIENCE', 187: 'CREATE_NAMED_ON_TEAM_AT_OBJECTTYPE', 186: 'PLAYER_HAS_OBJECT_COMPARISON', 185: 'UNIT_HAS_OBJECT_STATUS', 184: 'SET_REF_TO_NEREST_TEAM_OF_UNNAMED_TYPE_OWNED_BY_PLAYER', 183: 'UNIT_SPAWN_NAMED_LOCATION_ORIENTATION', 182: 'PLAYER_IS_IN_PLANNING_MODE', 181: 'NAMED_RECEIVE_UPGRADE', 180: 'PLAYER_HAS_NUM_UNITS_WITH_UPGRADE', 179: 'PLAYER_BUILT_UPGRADE', 178: 'COUNTER_MATH_COUNTER', 177: 'NAMED_OUTSIDE_AREA', 176: 'NAMED_FACE_WAYPOINT', 175: 'CREATE_UNNAMED_ON_TEAM_AT_WAYPOINT', 174: 'PLAYER_HAS_COMPARISON_UNIT_TYPE_IN_TRIGGER_AREA_WITH_UPGRADE', 173: 'TEAM_SET_PLAYERS_NEAREST_UNIT_OF_TYPE_TO_REFERENCE', 172: 'CREATE_REINFORCEMENT_TEAM', 171: 'ATTACK_MOVE_NAMED_UNIT_TO', 170: 'ATTACK_MOVE_TEAM_TO', 169: 'TEAM_MERGE_INTO_TEAM', 168: 'UNIT_SET_TEAM', 167: 'TEAM_SET_OVERRIDE_RELATION_TO_TEAM', 166: 'HIDE_COUNTDOWN_TIMER', 165: 'DISPLAY_COUNTDOWN_TIMER', 164: 'DISPLAY_NOTIFICATION_BOX_WITH_OBJECT_TYPE_IMAGE_OVERRIDE', 163: 'MAP_REVEAL_PERMANENTLY_IN_TRIGGER', 162: 'TEAM_ATTACK_NAMED', 161: 'CAMERA_FOLLOW_NAMED', 160: 'NAMED_DESTROYED', 159: 'VICTORY', 158: 'UNIT_AFFECT_OBJECT_PANEL_FLAGS', 157: 'TEAM_DELETE_LIVING', 156: 'PLAYER_TRANSFER_OWNERSHIP_PLAYER', 155: 'PLAYER_HAS_COMPARISON_UNIT_KIND_IN_TRIGGER_AREA', 154: 'MAP_REVEAL_IN_TRIGGER', 153: 'UNIT_SET_MODELCONDITION_FOR_DURATION', 152: 'TEAM_SET_MODELCONDITION_FOR_DURATION', 151: 'CONDITION_FALSE', 150: 'START_POSITION_IS', 149: 'CAMEO_FLASH', 148: 'ENEMY_SIGHTED', 147: 'TEAM_USE_COMMANDBUTTON_ABILITY', 146: 'UNIT_HEALTH', 145: 'UNIT_ATTACK_MOVE_TOWARDS_NEAREST_OBJECT_TYPE', 144: 'TEAM_ALL_USE_COMMANDBUTTON_ON_NEAREST_KINDOF', 143: 'SKIRMISH_SPECIAL_POWER_READY', 142: 'HIDE_UI', 141: 'MUSIC_PUSH_TRACK_FINITE_TIMES', 140: 'TEAM_UPGRADE', 139: 'OPTIONS_SET_OCCLUSION_MODE', 138: 'MAP_REVEAL_ALL_UNDO_PERM', 137: 'NAMED_TRANSFER_OWNERSHIP_PLAYER', 136: 'MOVE_CAMERA_BY_ANIMATION', 135: 'SHOW_MILITARY_CAPTION', 134: 'SET_UNIT_REFERENCE', 133: 'NAMED_FOLLOW_WAYPOINTS', 132: 'NAMED_INSIDE_AREA', 131: 'MOVE_NAMED_UNIT_TO', 130: 'PLAYER_ADD_RANKLEVEL', 129: 'TEAM_GIVE_EXPERIENCE_POINTS', 128: 'UNIT_TELEPORT_TO_WAYPOINT', 127: 'UNIT_GIVE_EXPERIENCE_POINTS', 126: 'TEAM_STOP', 125: 'SHOW_UI', 124: 'DESELECT', 123: 'ENABLE_INPUT', 122: 'CREATE_NAMED_ON_TEAM_AT_WAYPOINT', 121: 'OBJECTLIST_ADDOBJECTTYPE', 120: 'PLAYER_RELATES_PLAYER', 119: 'PLAYER_SET_MONEY', 118: 'MAP_SHROUD_ALL', 117: 'MOVE_CAMERA_TO', 116: 'NAMED_DELETE', 115: 'TEAM_DELETE', 114: 'MAP_REVEAL_ALL_PERM', 113: 'SET_FLAG', 112: 'TIMER_EXPIRED', 111: 'DISABLE_INPUT', 110: 'CAMERA_FADE_MULTIPLY', 109: 'IS_GAME_MODE_ACTIVE', 108: 'SET_PLAYER_KILLS_OF_KINDOF_TO_COUNTER', 107: 'DISABLE_SCRIPT', 106: 'ENABLE_SCRIPT', 105: 'COUNTER_COUNTER', 104: 'DISPLAY_COUNTER', 103: 'HIDE_COUNTER', 102: 'SET_REF_TO_NEREST_TEAM_OF_TYPE_OWNED_BY_PLAYER', 101: 'NAMED_NOT_DESTROYED', 100: 'SET_COUNTER_TO_COUNTER', 99: 'NAMED_KILL', 98: 'DISTANCE_BETWEEN_OBJ', 97: 'NAMED_OWNED_BY_PLAYER', 96: 'SET_COUNTER', 95: 'COUNTER', 94: 'PLAYER_TRIGGERED_SPECIAL_POWER', 93: 'INCREMENT_COUNTER', 92: 'ScriptActionFalse', 91: 'DISPLAY_NOTIFICATION_BOX', 90: 'FLAG', 89: 'ScriptGroup', 88: 'PLAYER_SET_OVERRIDE_RELATION_TO_TEAM', 87: 'TEAM_SET_OVERRIDE_RELATION_TO_PLAYER', 86: 'NAMED_STOP', 85: 'SET_MILLISECOND_TIMER', 84: 'CALL_SUBROUTINE', 83: 'CAMERA_FADE_SUBTRACT', 82: 'ScriptAction', 81: 'CONDITION_TRUE', 80: 'Condition', 79: 'OrCondition', 78: 'Script', 77: 'ScriptList', 76: 'PlayerScriptsList', 75: 'teamUnitExperienceLevel6', 74: 'teamUnitUpgradeList6', 73: 'teamUnitExperienceLevel5', 72: 'teamUnitUpgradeList5', 71: 'teamUnitType6', 70: 'teamUnitType5', 69: 'teamOnCreateScript', 68: 'teamDestroyedThreshold', 67: 'teamAttackCommonTarget', 66: 'teamUnitExperienceLevel4', 65: 'teamUnitUpgradeList4', 64: 'teamUnitExperienceLevel3', 63: 'teamUnitUpgradeList3', 62: 'teamUnitExperienceLevel2', 61: 'teamUnitUpgradeList2', 60: 'teamUnitExperienceLevel1', 59: 'teamUnitUpgradeList1', 58: 'teamAggressiveness', 57: 'teamUnitType4', 56: 'teamUnitType3', 55: 'teamUnitType2', 54: 'teamUnitType1', 53: 'teamExecutesActionsOnCreate', 52: 'teamInitialIdleSeconds', 51: 'teamProductionPriorityFailureDecrease', 50: 'teamProductionPrioritySuccessIncrease', 49: 'teamMaxInstances', 48: 'teamDescription', 47: 'teamUnitMinCount7', 46: 'teamUnitMaxCount7', 45: 'teamUnitMinCount6', 44: 'teamUnitMaxCount6', 43: 'teamUnitMinCount5', 42: 'teamUnitMaxCount5', 41: 'teamUnitMinCount4', 40: 'teamUnitMaxCount4', 39: 'teamUnitMinCount3', 38: 'teamUnitMaxCount3', 37: 'teamUnitMinCount2', 36: 'teamUnitMaxCount2', 35: 'teamUnitMinCount1', 34: 'teamUnitMaxCount1', 33: 'teamProductionPriority', 32: 'exportWithScript', 31: 'teamIsSingleton', 30: 'teamOwner', 29: 'teamName', 28: 'Teams', 27: 'LibraryMaps', 26: 'LibraryMapLists', 25: 'playerColor', 24: 'playerEnemies', 23: 'playerAllies', 22: 'playerFaction', 21: 'playerDisplayName', 20: 'playerIsHuman', 19: 'playerName', 18: 'SidesList', 17: 'MPPositionInfo', 16: 'MPPositionList', 15: 'isScenarioMultiplayer', 14: 'cameraGroundMaxHeight', 13: 'cameraGroundMinHeight', 12: 'mapDescription', 11: 'mapName', 10: 'compression', 9: 'cameraScrollSpeedScalar', 8: 'cameraYawAngle', 7: 'cameraPitchAngle', 6: 'cameraMaxHeight', 5: 'weather', 4: 'isLivingWorldScriptHolder', 3: 'WorldInfo', 2: 'BlendTileData', 1: 'HeightMapData'}

def load_asset_bytes(asset_name: str) -> bytes:
    """Load asset bytes from the data directory.
    
    Args:
        asset_name: Name of the asset file in tests/data/
        
    Returns:
        Bytes content of the asset file, or empty bytes if file doesn't exist
    """
    data_dir = Path(__file__).parent / "data"
    asset_path = data_dir / asset_name
    return asset_path.read_bytes()


def create_context(data: bytes) -> ParsingContext:
    """Helper function to create a ParsingContext from bytes."""
    stream = BinaryStream(io.BytesIO(data))
    context = ParsingContext(stream)
    context.assets = assets  # Set the assets mapping for tests
    
    return context
